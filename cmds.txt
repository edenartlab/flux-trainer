MODEL_PATH="/data/xander/Projects/cog/GitHub_repos/ComfyUI/models/unet/flux1-dev.safetensors"
CLIP_L_PATH="/data/xander/Projects/cog/GitHub_repos/ComfyUI/models/clip/clip_l.safetensors"
T5XXL_PATH="/data/xander/Projects/cog/GitHub_repos/ComfyUI/models/clip/t5xxl_fp16.safetensors"
AE_PATH="/data/xander/Projects/cog/GitHub_repos/ComfyUI/models/vae/ae.safetensors"

DATASET_CONFIG="/data/xander/Projects/cog/GitHub_repos/flux-trainer/dataset512.toml"
EVAL_PROMPTS="/data/xander/Projects/cog/GitHub_repos/flux-trainer/eval_prompts.txt"

TIMESTAMP=$(date +"%Y%m%d_%H%M")
OUTPUT_NAME="$(basename ${DATASET_CONFIG} .toml)_${TIMESTAMP}"
OUTPUT_DIR="/home/rednax/SSD2TB/Github_repos/sd-scripts/results/${OUTPUT_NAME}"

accelerate launch  --mixed_precision bf16 --num_cpu_threads_per_process 1 --num_processes 1 flux_train_network.py \
--dataset_config $DATASET_CONFIG \
--pretrained_model_name_or_path $MODEL_PATH \
--clip_l $CLIP_L_PATH --t5xxl $T5XXL_PATH \
--ae $AE_PATH --cache_latents_to_disk --save_model_as safetensors --sdpa --persistent_data_loader_workers \
--max_data_loader_n_workers 2 --seed 42 --gradient_checkpointing --mixed_precision bf16 --save_precision bf16 \
--network_module networks.lora_flux --network_dim 24 --optimizer_type adamw8bit --learning_rate 1.0e-4 \
--cache_text_encoder_outputs --cache_text_encoder_outputs_to_disk --fp8_base --text_encoder_batch_size 4 \
--highvram --max_train_epochs 36 --save_every_n_epochs 1 --sample_every_n_epochs 1 --sample_prompts $EVAL_PROMPTS --sample_at_first \
--output_dir $OUTPUT_DIR --output_name $OUTPUT_NAME \
--timestep_sampling shift --discrete_flow_shift 3.1582 --model_prediction_type raw --guidance_scale 1.0 \
--debug_dataset
